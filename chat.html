<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#00ff66">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="NEXCHAT">
  <meta name="format-detection" content="telephone=no">
  <meta name="x-apple-disable-message-reformatting" content="yes">
  <title>NEXCHAT - Messages</title>
  <link rel="stylesheet" href="chat.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/x-icon" href="logo.jpg">
  <link rel="apple-touch-icon" href="logo.jpg">
</head>

<body>
  <div class="app">
    <!-- TOP HEADER BAR -->
    <header class="top-header">
      <div class="header-left">
        <button id="dashboardBackBtn" class="back-button" title="Back to Dashboard">â† </button>
        <!-- Header shows NEXCHAT logo by default, contact name when in chat -->
        <div id="headerLogoContainer">
          <h1 class="header-logo" id="headerLogoText">NEXCHAT</h1>
        </div>
        <!-- Active chat contact info (shows when in chat) -->
        <div id="activeChatHeader" class="active-chat-header" style="display: none;">
          <img id="activeChatAvatar" src="" alt="Contact" class="active-chat-avatar" style="cursor: pointer;">
          <div class="active-chat-info">
            <div id="activeChatName" class="active-chat-name">Contact Name</div>
            <div id="activeChatStatus" class="active-chat-status">Online</div>
          </div>
        </div>
      </div>
      <div class="header-center">
        <div id="tokenDisplay" class="token-display" title="Your tokens">
          <span class="token-icon">â­</span>
          <span id="tokenCount">0</span>
        </div>
      </div>
      <div class="header-right-scroll">
        <div class="header-right">
          <button id="profile-sticker" class="header-icon-btn profile-sticker" title="Profile">ğŸ‘¤</button>

          <!-- Dark Mode Sliding Toggle Switch -->
          <div class="toggle-switch-container" title="Dark/Light Mode">
            <div class="toggle-switch" id="darkModeToggle">
              <div class="toggle-slider"></div>
              <span class="toggle-label dark-label">ğŸŒ™</span>
              <span class="toggle-label light-label">â˜€ï¸</span>
            </div>
          </div>

          <button id="fullscreen-btn-header" class="header-icon-btn" title="Fullscreen">â›¶</button>
          <button id="shop-btn-header" class="header-icon-btn" title="Buy Tokens"
            onclick="window.location.href='cart.html'">ğŸ›’</button>
          <button id="search-btn-header" class="header-icon-btn" title="Search">ğŸ”</button>
          <button id="settings-btn-header" class="header-icon-btn" title="Settings">âš™ï¸</button>
        </div>
      </div>
    </header>

    <!-- NEX-STATUS SECTION (only visible in chat list view) -->
    <div class="nex-status-container" id="statusContainer" style="display: none;">
      <div class="nex-status-header">
        <h3>ğŸ“ NEX-STATUS</h3>
        <p style="font-size: 12px; color: #888; margin: 8px 0;">Statuses expire after 24 hours</p>
      </div>
      <div class="status-input-area">
        <div class="my-status-card">
          <img id="myStatusPic" src="" alt="Your status" class="status-avatar">
          <input type="file" id="statusImageInput" style="display: none;" accept="image/*" />
          <button id="uploadStatusImageBtn" class="upload-status-btn" title="Upload image">ğŸ“¸</button>
          <input type="text" id="statusInput" class="status-input" placeholder="What's on your mind?" maxlength="150" />
          <button id="postStatusBtn" class="status-post-btn" title="Post Status">âœ“</button>
        </div>
      </div>
      <div id="statusFeed" class="status-feed">
        <div class="status-empty-state">
          <p>No statuses from your contacts yet</p>
        </div>
      </div>
    </div>

    <!-- GROUPS SECTION -->
    <div class="groups-container" id="groupsContainer" style="display: none;">
      <div class="groups-header">
        <h3>ğŸ‘¥ Groups</h3>
        <button id="createNewGroupBtn" class="new-chat-btn" title="Create Group">â•</button>
      </div>
      <ul id="groupsList" class="groups-list">
        <li class="empty-state">
          <p>No groups yet</p>
          <p class="hint">Create or join a group to get started</p>
        </li>
      </ul>
    </div>

    <!-- ANNOUNCEMENTS SECTION -->
    <div class="announcements-container" id="announcementsContainer" style="display: none;">
      <div class="announcements-header">
        <h3>ğŸ“¢ Announcements</h3>
      </div>
      <div id="announcementsFeed" class="announcements-feed">
        <div class="announcements-empty-state">
          <p>No announcements yet</p>
          <p class="hint">Stay tuned for updates from NEXCHAT</p>
        </div>
      </div>
    </div>

    <!-- MAIN CHAT LIST -->
    <main class="chat-main">
      <!-- CHAT LIST VIEW -->
      <div id="chatListView" class="chat-list-view">
        <!-- Search Bar -->
        <div class="search-container">
          <input type="text" id="searchInput" class="search-bar" placeholder="Search chats..." autocomplete="off" />
        </div>

        <!-- Filter Tabs -->
        <div class="filter-tabs">
          <button class="filter-tab active" data-filter="all" title="All chats">All</button>
          <button class="filter-tab" data-filter="unread" title="Unread messages">Unread</button>
          <button class="filter-tab" data-filter="favorites" title="Favorite chats">â­ Favorites</button>
          <button class="filter-tab" data-filter="groups" title="Group chats">ğŸ‘¥ Groups</button>
          <button class="filter-tab add-chat-tab" id="newChatFromTab" title="New chat">+</button>
        </div>

        <!-- Active Chats Section -->
        <div class="chats-section">
          <ul id="contactList" class="chat-list">
            <li class="empty-state">
              <p>No chats yet</p>
              <p class="hint">Search for friends to start chatting</p>
            </li>
          </ul>
        </div>

        <!-- Archived Section -->
        <div class="archived-section">
          <button class="archived-header" id="archivedToggle">
            ğŸ“¦ Archived Chats <span id="archivedCount" style="font-size: 12px; margin-left: 8px;">0</span>
          </button>
          <ul id="archivedList" class="chat-list archived-list" style="display: none;">
            <li class="empty-state" style="padding: 16px;">
              <p>No archived chats</p>
            </li>
          </ul>
        </div>
      </div>

      <!-- CHAT DETAIL VIEW -->
      <div id="chatDetailView" class="chat-detail-view" style="display: none;">
        <!-- Chat Header -->
        <div class="chat-detail-header">
          <button id="backBtn" class="back-btn" title="Back to chats">â€¹</button>
          <div class="chat-header-profile" id="chatHeaderProfile" style="cursor: pointer; position: relative;"
            title="Click to open group settings">
            <img id="chatProfilePic" src="" alt="profile" class="header-avatar">
            <div class="header-text">
              <h3 id="chatName">User</h3>
              <p id="statusText" class="status-dot">ğŸŸ¢ Online</p>
            </div>
          </div>
          <button id="menuBtn" class="three-dots-menu" title="More options">â‹¯</button>
        </div>

        <!-- Messages Area -->
        <div class="messages-area" id="messages-area">
          <div class="messages-list">
            <div class="empty-state">
              <p>No messages yet</p>
              <p class="hint">Start the conversation!</p>
            </div>
          </div>
          <div id="typingIndicator" class="typing-indicator" style="display: none;">
            <span class="typing-dot"></span>
            <span class="typing-dot"></span>
            <span class="typing-dot"></span>
          </div>
        </div>

        <!-- Chat Options Menu -->
        <div id="chatOptionsMenu" class="chat-options-dropdown" style="display: none;">
          <div class="dropdown-header">Options</div>
          <button id="callBtn" class="option-item call-option">â˜ï¸ Call User</button>
          <button id="videoCallBtn" class="option-item video-option">ğŸ“¹ Video Call</button>
          <button id="groupAdminBtn" class="option-item" style="display: none; background: #00d4ff; color: #000;">ğŸ‘¥
            Manage Members</button>
          <div class="dropdown-divider"></div>
          <button id="blockBtn" class="option-item danger">ğŸš« Block User</button>
          <button id="unblockBtn" class="option-item success" style="display: none;">âœ… Unblock User</button>
          <button id="reportBtn" class="option-item danger">âš ï¸ Report User</button>
          <button id="deleteBtn" class="option-item danger">ğŸ—‘ï¸ Delete Chat</button>
        </div>

        <!-- Reply Preview -->
        <div id="replyPreview" class="reply-preview" style="display: none;">
          <div class="reply-preview-content">
            <div class="reply-preview-text">
              <p class="reply-from">Replying to <span id="replyFromName"></span></p>
              <p class="reply-message" id="replyMessage"></p>
            </div>
            <button type="button" id="cancelReplyBtn" class="cancel-reply-btn" title="Cancel reply">âœ•</button>
          </div>
        </div>

        <!-- Message Input -->
        <div class="message-input-area">
          <!-- User Profile Display (shows in active chat) -->
          <div id="chatUserProfile" class="chat-user-profile" style="display: none;">
            <div class="chat-user-info">
              <img id="chatUserAvatar" src="" alt="User" class="chat-user-avatar">
              <div class="chat-user-details">
                <div id="chatUserName" class="chat-user-name">User Name</div>
                <div id="chatUserStatus" class="chat-user-status">Online</div>
              </div>
            </div>
          </div>

          <form id="message-form" class="message-form">
            <button type="button" id="attach-btn" class="input-btn" title="Attach file">ğŸ“</button>
            <input type="file" id="file-input" style="display: none;" accept="image/*,video/*,.pdf,.doc,.docx" />
            <input type="text" id="message-input" class="message-input" placeholder="Say something..."
              autocomplete="off" maxlength="1000" />
            <!-- <button type="button" id="emoji-btn" class="input-btn">ğŸ˜Š</button> -->
            <button type="button" id="poll-btn" class="input-btn" title="Create Poll" style="display: none;">ğŸ“Š</button>
            <button type="button" id="audio-record-btn" class="input-btn" title="Record audio">ğŸ¤</button>
            <!-- <button type="button" id="sticker-btn" class="sticker-btn" title="Post Status">âœ¨</button> -->
            <button type="button" id="vision-tester-btn" class="input-btn" title="Image Vision Tester"
              onclick="window.location.href='image-vision-tester.html'"
              style="background: linear-gradient(135deg, #00ff66, #00d4ff); color: #000; font-weight: 700;">ğŸ–¼ï¸</button>
            <button type="button" id="audio-send-btn" class="audio-send-btn" title="Send audio">â€º</button>
            <button type="submit" class="send-btn">âœ“</button>
          </form>

          <!-- Audio Recording UI -->
          <div id="audioRecordingUI" class="audio-recording-ui" style="display: none;">
            <div class="audio-record-controls">
              <button type="button" id="audioStopBtn" class="audio-control-btn stop-btn" title="Stop recording">â¹ï¸
                Stop</button>
              <div class="audio-timer">
                <span id="audioTimer">0:00</span>
              </div>
              <button type="button" id="audioSendNowBtn" class="audio-control-btn send-btn" title="Send now"
                style="background: #00ff66; color: #000; margin-left: 5px;">â¤ Send</button>
              <button type="button" id="audioCancelBtn" class="audio-control-btn cancel-btn" title="Cancel">âŒ
                Cancel</button>
            </div>
          </div>

          <!-- File attachment preview -->
          <div id="attachment-preview" class="attachment-preview" style="display: none;">
            <div class="attachment-item">
              <span id="attachment-name">File selected</span>
              <button type="button" id="remove-attachment" class="remove-attachment-btn" title="Remove">âœ•</button>
            </div>
          </div>

          <!-- Poll Modal -->
          <div id="pollModal" class="modal" style="display: none;">
            <div class="modal-content">
              <span class="close-modal"
                onclick="document.getElementById('pollModal').style.display='none'">&times;</span>
              <h2>ğŸ“Š Create a Poll</h2>
              <form id="pollForm">
                <div class="form-group">
                  <label>Poll Question</label>
                  <input type="text" id="pollQuestion" placeholder="Ask a question..." maxlength="100" required>
                </div>
                <div class="form-group">
                  <label>Options per line </label>
                  <textarea id="pollOptions" placeholder="Option 1&#10;Option 2&#10;Option 3" rows="4"
                    required></textarea>
                </div>
                <button type="submit" class="btn-primary">âœ“ Create Poll</button>
              </form>
            </div>
          </div>

          <!-- Emoji Picker -->
          <div id="emoji-picker" class="emoji-picker-popup" style="display: none;">
            <div class="emoji-header">
              <span>Emojis</span>
              <button type="button" id="close-emoji-btn" class="close-btn">âœ•</button>
            </div>
            <div id="emoji-grid" class="emoji-grid"></div>
          </div>
        </div>
      </div>

      <!-- SEARCH OVERLAY -->
      <div id="search-overlay" class="search-overlay" style="display: none;">
        <div id="search-modal" class="search-modal">
          <div class="search-header">
            <input type="text" id="search-input" class="search-input" placeholder="Search by UID, username, or name..."
              autocomplete="off" />
            <button id="browse-users-btn" class="search-action-btn" title="Browse all users">ğŸ‘¥</button>
            <button id="close-search-btn" class="close-btn">âœ•</button>
          </div>
          <div id="search-results" class="search-results"></div>
        </div>
      </div>

      <!-- INFO SIDEBAR (on chat detail) - Enhanced Group Info Panel -->
      <div id="infoSidebar" class="info-panel" style="display: none;">
        <div class="info-header">
          <button id="closeInfoBtn" class="close-btn" style="position: absolute; left: 16px;">â€¹</button>
          <button id="closeInfoBtn2" class="close-btn" style="position: absolute; right: 16px;">â‹®</button>
        </div>

        <div class="info-body">
          <!-- Profile Section -->
          <div class="info-profile-section">
            <div class="profile-pic-container">
              <img id="infoPic" src="" alt="profile" class="info-profile-pic">
            </div>
            <h2 id="infoName">Group Name</h2>
            <p id="infoMemberCount" class="member-count">Group Â· 0 members</p>
          </div>

          <!-- Action Buttons -->
          <div class="info-action-buttons">
            <button id="infoAudioBtn" class="info-action-btn">
              <span class="action-icon">â˜ï¸</span>
              <span class="action-label">Audio</span>
            </button>
            <button id="infoVideoBtn" class="info-action-btn">
              <span class="action-icon">ğŸ“¹</span>
              <span class="action-label">Video</span>
            </button>
            <button id="infoAddBtn" class="info-action-btn">
              <span class="action-icon">ğŸ‘¥</span>
              <span class="action-label">Add</span>
            </button>
            <button id="infoSearchBtn" class="info-action-btn">
              <span class="action-icon">ğŸ”</span>
              <span class="action-label">Search</span>
            </button>
          </div>

          <!-- Media Section -->
          <div class="info-section">
            <div class="section-header">
              <span class="section-title">Media, links, and docs</span>
              <span class="section-count" id="mediaCount">0</span>
              <span class="section-arrow">â€º</span>
            </div>
            <div id="mediaPreview" class="media-preview">
              <!-- Media items will be populated here -->
            </div>
          </div>

          <!-- Notifications Section -->
          <div class="info-section">
            <div class="section-item">
              <span class="section-icon">ğŸ””</span>
              <div class="section-content">
                <div class="section-label">Notifications</div>
                <div class="section-value" id="notificationValue">All</div>
              </div>
            </div>
          </div>

          <!-- Media Visibility Section -->
          <div class="info-section">
            <div class="section-item">
              <span class="section-icon">ğŸ‘ï¸</span>
              <div class="section-content">
                <div class="section-label">Media visibility</div>
                <div class="section-value" id="mediaVisibilityValue">Off</div>
              </div>
            </div>
          </div>

          <!-- Kept Messages Section -->
          <div class="info-section">
            <div class="section-item">
              <span class="section-icon">ğŸ“Œ</span>
              <div class="section-content">
                <div class="section-label">Kept messages</div>
                <div class="section-value" id="keptMessagesValue">Only admins can keep or unkeep messages in this group.
                </div>
              </div>
            </div>
          </div>

          <!-- Encryption Section -->
          <div class="info-section">
            <div class="section-item">
              <span class="section-icon">ğŸ”’</span>
              <div class="section-content">
                <div class="section-label">Encryption</div>
                <div class="section-value" id="encryptionValue">Messages and calls are end-to-end encrypted</div>
              </div>
            </div>
          </div>

          <!-- Mute/Block/Delete Actions -->
          <div class="info-section">
            <div class="section-item" id="muteUserItem" style="cursor: pointer;">
              <span class="section-icon">ğŸ”‡</span>
              <div class="section-content" style="flex: 1;">
                <div class="section-label">Mute User</div>
              </div>
              <div class="toggle-switch-small"
                style="position: relative; display: inline-block; width: 40px; height: 24px;">
                <input type="checkbox" id="muteUserToggle" style="opacity: 0; width: 0; height: 0;">
                <span class="slider round"
                  style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #333; transition: .4s; border-radius: 34px; border: 1px solid #555;"></span>
                <style>
                  #muteUserToggle:checked+.slider {
                    background-color: #00ff66;
                    border-color: #00ff66;
                  }

                  #muteUserToggle:checked+.slider:before {
                    transform: translateX(16px);
                    background-color: #000;
                  }

                  .slider:before {
                    position: absolute;
                    content: "";
                    height: 16px;
                    width: 16px;
                    left: 3px;
                    bottom: 3px;
                    background-color: #888;
                    transition: .4s;
                    border-radius: 50%;
                  }
                </style>
              </div>
            </div>
          </div>

          <div class="info-section">
            <div class="section-item" id="infoBlockBtn" style="cursor: pointer; color: #ff4d4d;">
              <span class="section-icon" style="color: #ff4d4d;">ğŸš«</span>
              <div class="section-content">
                <div class="section-label">Block User</div>
              </div>
            </div>
            <div class="section-item" id="infoUnblockBtn" style="cursor: pointer; color: #00ff66; display: none;">
              <span class="section-icon" style="color: #00ff66;">âœ…</span>
              <div class="section-content">
                <div class="section-label">Unblock User</div>
              </div>
            </div>
          </div>

          <div class="info-section">
            <div class="section-item" id="infoDeleteBtn" style="cursor: pointer; color: #ff4d4d;">
              <span class="section-icon" style="color: #ff4d4d;">ğŸ—‘ï¸</span>
              <div class="section-content">
                <div class="section-label">Delete User</div>
              </div>
            </div>
          </div>

          <!-- Members Section (for groups) -->
          <div class="info-section" id="membersList" style="display: none;">
            <div class="section-title">Members</div>
            <div id="membersListContent">
              <!-- Members will be populated here -->
            </div>
          </div>
        </div>
      </div>

      <!-- STATUS VIEWER MODAL (Used for Profile Pics too) -->
      <div id="statusViewerModal" class="modal" style="display: none;">
        <div class="status-viewer-content">
          <button id="closeStatusViewerBtn" class="close-btn"
            style="position: absolute; top: 16px; right: 16px; z-index: 10;">âœ•</button>
          <div class="status-viewer-image-container">
            <img id="statusViewerImage" src="" alt="Status" class="status-viewer-image">
          </div>
          <div class="status-viewer-info">
            <div class="status-viewer-header">
              <img id="statusViewerAvatar" src="" alt="user" class="status-viewer-avatar">
              <div class="status-viewer-text">
                <h3 id="statusViewerName">User Name</h3>
                <p id="statusViewerTime">Just now</p>
              </div>
            </div>
            <p id="statusViewerCaption" class="status-viewer-caption">Caption text goes here</p>
          </div>
        </div>
      </div>

      <!-- NEW PROFILE PIC MODAL -->
      <div id="profilePicModal" class="modal"
        style="display: none; align-items: center; justify-content: center; background: rgba(0,0,0,0.95);">
        <div style="position: relative; max-width: 90%; max-height: 90%;">
          <button id="closeProfileModal"
            style="position: absolute; top: -40px; right: 0; background: none; border: none; color: white; font-size: 30px; cursor: pointer;">âœ•</button>
          <img id="profileModalImg" src=""
            style="max-width: 100%; max-height: 80vh; border: 2px solid #00ff66; box-shadow: 0 0 50px rgba(0, 255, 102, 0.2); border-radius: 8px;">
          <h3 id="profileModalName"
            style="color:white; text-align:center; margin-top: 15px; font-family: 'Rajdhani', sans-serif; letter-spacing: 2px;">
            USER</h3>
          <button id="editProfileBtnModal"
            style="display:none; margin: 10px auto; display: block; background: #00ff66; color: #000; padding: 10px 20px; border: none; font-weight: bold; cursor: pointer; border-radius: 5px;">EDIT
            AVATAR</button>
        </div>
      </div>

      <!-- OFFLINE INDICATOR -->
      <div id="offlineIndicator" class="offline-indicator" style="display: none;">
        <span class="offline-icon">ğŸ“µ</span>
        <span class="offline-text">You are offline - Messages will send when online</span>
      </div>

      <!-- REELS FUNCTIONALITY REMOVED -->

      <!-- CREATE GROUP MODAL -->
      <div id="createGroupModal" class="modal" style="display: none;">
        <div class="modal-content">
          <span class="close-modal"
            onclick="document.getElementById('createGroupModal').style.display='none'">&times;</span>
          <h2>ğŸ‘¥ Create Group</h2>
          <form id="createGroupForm">
            <div class="form-group" style="text-align: center; margin-bottom: 20px;">
              <label>Group Icon</label>
              <div style="position: relative; width: 80px; height: 80px; margin: 0 auto;">
                <img id="groupIconPreview" src="assets/default_group.png"
                  onerror="this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDBmZjY2IiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCI+PGNpcmNsZSBjeD0iOS41IiBjeT0iNyIgcj0iNCIvPjxwYXRoIGQ9Ik0zIDIxdi0yYTQgNCAwIDAgMSA0LTRoNWE0IDQgMCAwIDEgNCA0djIiLz48cGF0aCBkPSJNMTYgMy4xM2E0IDQgMCAwIDEgMCA3Ljc1Ii8+PHBhdGggZD0iTTIxIDIxdi0yYTQgNCAwIDAgMC0zLTMuODUiLz48L3N2Zz4='"
                  style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover; border: 2px solid #00ff66;">
                <div onclick="document.getElementById('groupIconInput').click()"
                  style="position: absolute; bottom: 0; right: 0; background: #00ff66; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; cursor: pointer; border: 2px solid #000;">
                  <span style="color: #000; font-size: 14px; font-weight: bold;">+</span>
                </div>
              </div>
              <input type="file" id="groupIconInput" accept="image/*" style="display: none;"
                onchange="const file=this.files[0];if(file){const reader=new FileReader();reader.onload=e=>document.getElementById('groupIconPreview').src=e.target.result;reader.readAsDataURL(file);}">
              <button type="button" id="generateGroupAvatarBtn"
                style="margin-top: 10px; background: transparent; border: 1px solid #00ff66; color: #00ff66; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">ğŸ²
                Generate NEX Avatar</button>
            </div>
            <div class="form-group">
              <label>Group Name</label>
              <input type="text" id="groupName" placeholder="Group name..." maxlength="50" required>
            </div>
            <div class="form-group">
              <label>Group Description</label>
              <textarea id="groupDescription" placeholder="Group description..." maxlength="200" rows="3"></textarea>
            </div>
            <div class="form-group">
              <label>Add Members (select from contacts)</label>
              <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                <button type="button" id="addAllContactsBtn" class="btn-secondary" style="flex: 1;">âœ“ Add All
                  Contacts</button>
                <button type="button" id="clearAllContactsBtn" class="btn-secondary" style="flex: 1;">âœ— Clear
                  All</button>
              </div>
              <div id="groupMembersList"
                style="max-height: 200px; overflow-y: auto; border: 1px solid #00ff66; border-radius: 6px; padding: 10px;">
                <p style="color: #888; text-align: center;">Loading contacts...</p>
              </div>
            </div>
            <button type="submit" class="btn-primary">âœ“ Create Group</button>
            <div id="groupCreateResult"
              style="margin-top: 15px; padding: 10px; border-radius: 6px; text-align: center; display: none;"></div>
          </form>
        </div>
      </div>

      <!-- GROUP INFO MODAL -->
      <div id="groupInfoModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
          <span class="close-modal"
            onclick="document.getElementById('groupInfoModal').style.display='none'">&times;</span>
          <div style="text-align: center; margin-bottom: 20px;">
            <img id="infoGroupIcon" src=""
              style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover; border: 3px solid #00ff66; margin-bottom: 10px;">
            <h2 id="infoGroupName" style="margin: 0; color: #00ff66;">Group Name</h2>
            <p id="infoGroupDesc" style="color: #aaa; font-size: 14px; margin-top: 5px;">Description</p>
          </div>

          <div class="settings-section">
            <h3>ğŸ‘¥ Members (<span id="infoMemberCount">0</span>)</h3>
            <div id="infoMembersList" style="max-height: 250px; overflow-y: auto; margin-top: 10px;">
              <!-- Members will be populated here -->
            </div>
          </div>

          <div class="settings-section" id="adminActionsSection" style="display: none;">
            <h3>ğŸ›¡ï¸ Admin Actions</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
              <button id="addMemberBtn" class="btn-secondary">â• Add Member</button>
              <!-- Delete Group Button (only for admin) -->
              <button id="deleteGroupBtn"
                style="background: #ff4d4d; color: white; border: none; padding: 10px; border-radius: 8px; cursor: pointer; font-weight: bold;">ğŸ—‘ï¸
                Delete Group</button>
            </div>
          </div>

          <button id="leaveGroupBtn"
            style="width: 100%; margin-top: 20px; background: #333; color: #ff4d4d; border: 1px solid #ff4d4d; padding: 10px; border-radius: 8px; cursor: pointer; font-weight: bold;">ğŸšª
            Leave Group</button>
        </div>
      </div>

      <!-- REELS FUNCTIONALITY REMOVED -->

      <!-- SETTINGS MODAL -->
      <div id="settingsModal" class="settings-modal" style="display: none;">
        <div class="settings-modal-content">
          <div class="settings-header">
            <h2>âš™ï¸ Settings</h2>
            <button id="closeSettingsBtn" class="close-btn">âœ•</button>
          </div>
          <div class="settings-body">
            <div class="settings-section">
              <h3>Notifications</h3>
              <div class="setting-item">
                <label>
                  <input type="checkbox" id="notifToggle" checked>
                  Enable Notifications
                </label>
              </div>
              <div class="setting-item">
                <label>
                  <input type="checkbox" id="soundToggle" checked>
                  Sound Effects
                </label>
              </div>
            </div>

            <div class="settings-section">
              <h3>Privacy</h3>
              <div class="setting-item">
                <label>
                  <input type="checkbox" id="onlineStatusToggle" checked>
                  Show Online Status
                </label>
              </div>
              <div class="setting-item">
                <label>
                  <input type="checkbox" id="readReceiptsToggle" checked>
                  Read Receipts
                </label>
              </div>
            </div>

            <div class="settings-section">
              <h3>Theme</h3>
              <div class="setting-item">
                <label>
                  <input type="radio" name="theme" value="light" id="themeLight">
                  Light
                </label>
              </div>
              <div class="setting-item">
                <label>
                  <input type="radio" name="theme" value="dark" id="themeDark" checked>
                  Dark
                </label>
              </div>
            </div>

            <div class="settings-section">
              <h3>âœï¸ Text Element Adjustment</h3>
              <div class="setting-item">
                <label for="fontFamilySelect"><strong>Font Family</strong></label>
                <select id="fontFamilySelect"
                  style="width: 100%; padding: 8px; background: #2a2a2a; border: 1px solid #00ff66; border-radius: 6px; color: #00ff66; margin-top: 6px;">
                  <option value="Arial, sans-serif">Arial</option>
                  <option value="'Segoe UI', Tahoma, Geneva, Verdana, sans-serif">Segoe UI</option>
                  <option value="'Courier New', monospace">Courier New</option>
                  <option value="Georgia, serif">Georgia</option>
                  <option value="'Trebuchet MS', sans-serif">Trebuchet MS</option>
                </select>
              </div>
              <div class="setting-item">
                <label for="letterSpacingRange"><strong>Letter Spacing: <span
                      id="letterSpacingValue">0</span>px</strong></label>
                <input type="range" id="letterSpacingRange" min="-2" max="5" value="0" step="0.5"
                  style="width: 100%; margin-top: 6px;">
              </div>
              <div class="setting-item">
                <label for="lineHeightRange"><strong>Line Height: <span id="lineHeightValue">1.5</span></strong></label>
                <input type="range" id="lineHeightRange" min="1" max="2.5" value="1.5" step="0.1"
                  style="width: 100%; margin-top: 6px;">
              </div>
              <div class="setting-item">
                <label><strong>Text Alignment</strong></label>
                <div style="display: flex; gap: 8px; margin-top: 8px;">
                  <button id="alignLeft" class="text-align-btn"
                    style="flex: 1; padding: 8px; background: #00ff66; color: #000; border: none; border-radius: 4px; cursor: pointer; font-weight: 600;">Left</button>
                  <button id="alignCenter" class="text-align-btn"
                    style="flex: 1; padding: 8px; background: #444; color: #fff; border: none; border-radius: 4px; cursor: pointer; font-weight: 600;">Center</button>
                  <button id="alignRight" class="text-align-btn"
                    style="flex: 1; padding: 8px; background: #444; color: #fff; border: none; border-radius: 4px; cursor: pointer; font-weight: 600;">Right</button>
                </div>
              </div>
            </div>

            <div class="settings-section">
              <h3>ğŸ’¬ Chat Text Size</h3>
              <div class="setting-item">
                <label>
                  <input type="radio" name="chatSize" value="small" id="chatSizeSmall">
                  Small
                </label>
              </div>
              <div class="setting-item">
                <label>
                  <input type="radio" name="chatSize" value="medium" id="chatSizeMedium" checked>
                  Medium (Default)
                </label>
              </div>
              <div class="setting-item">
                <label>
                  <input type="radio" name="chatSize" value="large" id="chatSizeLarge">
                  Large
                </label>
              </div>
              <div class="setting-item">
                <label>
                  <input type="radio" name="chatSize" value="extra-large" id="chatSizeExtraLarge">
                  Extra Large
                </label>
              </div>
            </div>

            <div class="settings-section">
              <h3>ï¸ Background Image</h3>
              <div class="setting-item">
                <label><strong>Change Chat Background</strong></label>
                <input type="file" id="backgroundImageInput" accept="image/*"
                  style="width: 100%; padding: 10px; margin: 8px 0; background: #1a1a1a; border: 1px solid #00ff66; border-radius: 6px; color: #00ff66;">
              </div>
              <button id="uploadBackgroundBtn" class="settings-action-btn"
                style="background: #00ff66; color: #000; width: 100%;">ğŸ“¸ Upload Background</button>
              <button id="removeBackgroundBtn" class="settings-action-btn"
                style="background: #ff6b6b; color: #fff; width: 100%; margin-top: 8px;">ğŸ—‘ï¸ Remove Background</button>
              <div id="backgroundPreview"
                style="width: 100%; height: 100px; margin-top: 12px; border-radius: 8px; border: 2px solid #00ff66; background-size: cover; background-position: center;">
              </div>
            </div>

            <div class="settings-section">
              <h3>ğŸ¨ Chat-Specific Background</h3>
              <p style="color: #888; font-size: 12px; margin-bottom: 10px;">Set a unique background for this chat</p>
              <div class="setting-item">
                <label><strong>Choose Image</strong></label>
                <input type="file" id="chatBackgroundImageInput" accept="image/*"
                  style="width: 100%; padding: 10px; margin: 8px 0; background: #1a1a1a; border: 1px solid #00ff66; border-radius: 6px; color: #00ff66;">
              </div>
              <button id="uploadChatBackgroundBtn" class="settings-action-btn"
                style="background: #00d4ff; color: #000; width: 100%;">ğŸ¨ Set Chat Background</button>
              <button id="removeChatBackgroundBtn" class="settings-action-btn"
                style="background: #ff9900; color: #000; width: 100%; margin-top: 8px;">ğŸ—‘ï¸ Remove Chat
                Background</button>
            </div>

            <div class="settings-section">
              <h3>Account</h3>
              <div class="setting-item">
                <label><strong>Your UID:</strong></label>
                <p id="userUIDDisplay"
                  style="padding: 10px; background: rgba(0, 255, 102, 0.1); border: 1px solid #00ff66; border-radius: 6px; color: #00ff66; word-break: break-all; font-family: monospace; font-size: 12px; margin: 8px 0;">
                  Loading...</p>
                <button id="copyUIDBtn" class="settings-action-btn"
                  style="background: #00ff66; color: #000; margin-top: 8px;">ğŸ“‹ Copy UID</button>
              </div>
              <button id="changePasswordBtn" class="settings-action-btn">ğŸ”‘ Change Password</button>
              <button id="clearCacheBtn" class="settings-action-btn">ğŸ—‘ï¸ Clear Cache</button>
            </div>

            <div class="settings-section">
              <h3>ğŸ’³ Transfer Tokens</h3>
              <div class="setting-item"
                style="flex-direction: column; align-items: flex-start; border: none; padding: 0;">
                <div
                  style="width: 100%; background: rgba(0, 255, 102, 0.1); border: 1px solid #00ff66; border-radius: 8px; padding: 12px; margin-bottom: 12px;">
                  <p
                    style="color: #888; margin: 0 0 4px 0; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;">
                    Your Balance</p>
                  <p style="color: #00ff66; margin: 0; font-size: 20px; font-weight: 700;">
                    <span id="currentTokenBalance">0</span>
                    <span style="font-size: 14px; opacity: 0.8;">â­ Tokens</span>
                  </p>
                </div>
              </div>
              <div class="setting-item"
                style="flex-direction: column; align-items: flex-start; border: none; padding: 0;">
                <label style="font-size: 13px; margin-bottom: 8px;"><strong>Recipient UID:</strong></label>
                <input type="text" id="recipientUID" placeholder="Paste recipient's UID here..."
                  style="width: 100%; padding: 11px 12px; background: #2a2a2a; border: 1px solid #00ff66; border-radius: 8px; color: #00ff66; font-size: 12px; transition: all 0.2s ease;"
                  onfocus="this.style.borderColor='#00ff66'; this.style.boxShadow='0 0 12px rgba(0, 255, 102, 0.3)';"
                  onblur="this.style.boxShadow='none';">
              </div>
              <div class="setting-item"
                style="flex-direction: column; align-items: flex-start; border: none; padding: 0; margin-top: 12px;">
                <label style="font-size: 13px; margin-bottom: 8px;"><strong>Amount:</strong></label>
                <input type="number" id="transferAmount" placeholder="Enter amount..." min="1" max="99999"
                  style="width: 100%; padding: 11px 12px; background: #2a2a2a; border: 1px solid #00ff66; border-radius: 8px; color: #00ff66; font-size: 12px; transition: all 0.2s ease;"
                  onfocus="this.style.borderColor='#00ff66'; this.style.boxShadow='0 0 12px rgba(0, 255, 102, 0.3)';"
                  onblur="this.style.boxShadow='none';">
              </div>
              <button id="transferTokensBtn" class="settings-action-btn"
                style="background: linear-gradient(135deg, #00ff66, #00dd55); color: #000; width: 100%; margin-top: 12px; font-weight: 700;">ğŸš€
                Send Tokens</button>
              <div id="transferResult"></div>
            </div>

            <div class="settings-section">
              <button id="adminPanelBtn" class="settings-action-btn"
                style="background: #ff6600; color: #fff; display: none;">ğŸ‘‘ Admin Panel</button>
            </div>

            <div class="settings-section">
              <button id="logoutSettingsBtn" class="settings-action-btn danger">ğŸšª Logout</button>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- BOTTOM NAVIGATION -->
    <nav class="bottom-nav">
      <button id="nav-messages" class="nav-item active" data-nav="chats" title="Messages">ğŸ’¬</button>
      <button id="nav-status" class="nav-item" data-nav="updates" title="View Statuses">âœ¨</button>
      <button id="nav-groups" class="nav-item" data-nav="communities" title="Groups">ğŸ‘¥</button>
      <button id="nav-announcements" class="nav-item" data-nav="announcements" title="Announcements">ğŸ“¢</button>
      <button id="nav-marketplace" class="nav-item" data-nav="marketplace" title="Marketplace"
        onclick="window.location.href='advertisement.html'">ğŸ›ï¸</button>
      <button id="nav-games" class="nav-item" data-nav="games" title="Gaming Hub"
        onclick="window.location.href='gaminghub.html'">ğŸ®</button>
      <button id="logout-btn" class="nav-item logout" title="Logout">ğŸšª</button>
    </nav>
  </div>

  <!-- NOTIFICATION CONTAINER -->
  <div id="notificationContainer" class="notification-container"></div>

  <script src="pwa-install.js"></script>
  <script src="app-prompt.js"></script>
  <script src="messaging-features.js"></script>
  <script src="chat-navigation.js"></script>
  <script type="module" src="chat.js"></script>
  <script src="button-setup.js"></script>
  <style>
    @keyframes slideUp {
      from {
        transform: translateY(0);
        opacity: 1;
      }

      to {
        transform: translateY(-100%);
        opacity: 0;
      }
    }

    .bottom-nav {
      margin-bottom: 60px;
    }

    .back-button {
      background: transparent;
      border: none;
      color: #00ff66;
      font-size: 24px;
      cursor: pointer;
      padding: 5px 10px;
      margin-right: 10px;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 40px;
      width: 40px;
      border-radius: 50%;
    }

    .back-button:hover {
      background: rgba(0, 255, 102, 0.1);
      transform: scale(1.1);
      box-shadow: 0 0 10px rgba(0, 255, 102, 0.3);
    }

    .back-button:active {
      transform: scale(0.95);
    }

    /* Dark Mode Toggle Switch Styles */
    .toggle-switch-container {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0 8px;
    }

    .toggle-switch {
      position: relative;
      width: 60px;
      height: 30px;
      background: linear-gradient(135deg, rgba(0, 0, 0, 0.4) 0%, rgba(0, 0, 0, 0.2) 100%);
      border: 2px solid #00ff66;
      border-radius: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      padding: 2px;
      transition: all 0.3s ease;
      user-select: none;
    }

    .toggle-switch:hover {
      box-shadow: 0 0 10px rgba(0, 255, 102, 0.4);
      border-color: #00ff66;
    }

    .toggle-switch.active {
      background: linear-gradient(135deg, rgba(0, 255, 102, 0.2) 0%, rgba(0, 255, 102, 0.1) 100%);
    }

    .toggle-slider {
      position: absolute;
      width: 26px;
      height: 26px;
      background: #00ff66;
      border-radius: 50%;
      top: 2px;
      left: 2px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 2px 8px rgba(0, 255, 102, 0.3);
    }

    .toggle-switch.active .toggle-slider {
      left: 32px;
      background: #00ff66;
      box-shadow: 0 2px 8px rgba(0, 255, 102, 0.5);
    }

    .toggle-label {
      position: absolute;
      font-size: 14px;
      font-weight: bold;
      transition: opacity 0.3s ease;
      user-select: none;
    }

    .dark-label {
      right: 8px;
      color: #00ff66;
      opacity: 1;
    }

    .light-label {
      left: 8px;
      color: #ffaa00;
      opacity: 0;
    }

    .toggle-switch.active .dark-label {
      opacity: 0;
    }

    .toggle-switch.active .light-label {
      opacity: 1;
    }
  </style>
</body>

</html>