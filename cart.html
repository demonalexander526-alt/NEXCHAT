<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#00ff66">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="format-detection" content="telephone=no">
  <title>NEXCHAT Store - Buy Tokens</title>
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/x-icon" href="logo.jpg">
  <link rel="apple-touch-icon" href="logo.jpg">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Orbitron', monospace;
      background: linear-gradient(135deg, #0a0f1a 0%, #0d1320 100%);
      color: #00ff66;
      min-height: 100vh;
      overflow-x: hidden;
    }

    .store-container {
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
    }

    .store-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 40px;
      padding-bottom: 20px;
      border-bottom: 2px solid #00ff66;
    }

    .store-header h1 {
      font-size: 32px;
      text-shadow: 0 0 15px rgba(0, 255, 102, 0.5);
    }

    .back-btn {
      background: transparent;
      border: 1px solid #00ff66;
      color: #00ff66;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .back-btn:hover {
      background: rgba(0, 255, 102, 0.1);
      transform: scale(1.05);
    }

    .user-info {
      background: rgba(0, 255, 102, 0.05);
      border: 1px solid #00ff66;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .user-balance {
      font-size: 18px;
      font-weight: 600;
    }

    .balance-value {
      color: #00ff66;
      font-size: 24px;
      text-shadow: 0 0 10px rgba(0, 255, 102, 0.3);
    }

    .packages-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }

    .package-card {
      background: linear-gradient(135deg, rgba(0, 255, 102, 0.1) 0%, rgba(0, 255, 102, 0.05) 100%);
      border: 2px solid #00ff66;
      border-radius: 12px;
      padding: 25px;
      text-align: center;
      transition: all 0.3s ease;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }

    .package-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(0, 255, 102, 0.2), transparent);
      transition: left 0.5s ease;
    }

    .package-card:hover {
      transform: translateY(-10px);
      box-shadow: 0 10px 30px rgba(0, 255, 102, 0.2);
      border-color: #00ff66;
    }

    .package-card:hover::before {
      left: 100%;
    }

    .package-icon {
      font-size: 40px;
      margin-bottom: 15px;
    }

    .package-tokens {
      font-size: 28px;
      font-weight: 700;
      color: #00ff66;
      margin-bottom: 10px;
      text-shadow: 0 0 10px rgba(0, 255, 102, 0.3);
    }

    .package-label {
      font-size: 12px;
      color: rgba(0, 255, 102, 0.7);
      margin-bottom: 15px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .package-price {
      font-size: 20px;
      font-weight: 700;
      color: #00ff66;
      margin-bottom: 8px;
    }

    .package-currency {
      font-size: 12px;
      color: rgba(0, 255, 102, 0.6);
      margin-bottom: 15px;
    }

    .buy-btn {
      width: 100%;
      background: #00ff66;
      color: #0a0f1a;
      border: none;
      padding: 12px;
      border-radius: 6px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 14px;
    }

    .buy-btn:hover {
      background: #00dd55;
      transform: scale(1.05);
      box-shadow: 0 5px 15px rgba(0, 255, 102, 0.3);
    }

    .buy-btn:active {
      transform: scale(0.98);
    }

    .special-badge {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #ff6600;
      color: #fff;
      padding: 5px 10px;
      border-radius: 4px;
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
    }

    .payment-methods {
      background: rgba(0, 255, 102, 0.05);
      border: 1px solid #00ff66;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 30px;
    }

    .payment-methods h3 {
      margin-bottom: 15px;
      color: #00ff66;
    }

    .payment-options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
    }

    .payment-option {
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid #00ff66;
      border-radius: 6px;
      padding: 15px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .payment-option:hover {
      background: rgba(0, 255, 102, 0.1);
      box-shadow: 0 5px 15px rgba(0, 255, 102, 0.2);
    }

    .payment-option.active {
      background: rgba(0, 255, 102, 0.2);
      border-color: #00ff66;
    }

    .payment-icon {
      font-size: 28px;
      margin-bottom: 8px;
    }

    .payment-name {
      font-size: 12px;
      font-weight: 600;
    }

    .faq-section {
      background: rgba(0, 255, 102, 0.05);
      border: 1px solid #00ff66;
      border-radius: 10px;
      padding: 20px;
    }

    .faq-section h3 {
      margin-bottom: 15px;
      color: #00ff66;
    }

    .faq-item {
      margin-bottom: 15px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(0, 255, 102, 0.2);
    }

    .faq-item:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }

    .faq-question {
      font-weight: 600;
      margin-bottom: 5px;
      color: #00ff66;
    }

    .faq-answer {
      font-size: 12px;
      color: rgba(0, 255, 102, 0.7);
      line-height: 1.6;
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(10, 15, 26, 0.9);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: #1a1a1a;
      border: 2px solid #00ff66;
      border-radius: 12px;
      padding: 30px;
      max-width: 400px;
      width: 90%;
      text-align: center;
    }

    .modal-close {
      float: right;
      background: none;
      border: none;
      color: #00ff66;
      font-size: 24px;
      cursor: pointer;
    }

    .modal h2 {
      margin: 20px 0;
      color: #00ff66;
    }

    .modal input {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      background: #0a0f1a;
      border: 1px solid #00ff66;
      border-radius: 6px;
      color: #00ff66;
      font-family: 'Orbitron', monospace;
    }

    .modal button {
      width: 100%;
      padding: 12px;
      background: #00ff66;
      color: #0a0f1a;
      border: none;
      border-radius: 6px;
      font-weight: 700;
      cursor: pointer;
      margin-top: 15px;
    }

    .modal button:hover {
      background: #00dd55;
    }

    .loading {
      display: none;
      text-align: center;
      margin: 20px 0;
    }

    .spinner {
      border: 3px solid rgba(0, 255, 102, 0.3);
      border-top: 3px solid #00ff66;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    @media (max-width: 768px) {
      .packages-grid {
        grid-template-columns: 1fr;
      }

      .store-header {
        flex-direction: column;
        gap: 15px;
      }

      .user-info {
        flex-direction: column;
        gap: 15px;
      }
    }
  </style>
</head>
<body>
  <div class="store-container">
    <div class="store-header">
      <h1>üíé NEXCHAT Token Store</h1>
      <button class="back-btn" onclick="window.location.href='chat.html'">‚Üê Back to Chat</button>
    </div>

    <div class="user-info">
      <div>
        <div class="user-balance">Your Balance</div>
        <div class="balance-value"><span id="currentBalance">0</span> ‚≠ê</div>
      </div>
      <div style="text-align: right; color: rgba(0, 255, 102, 0.7); font-size: 12px;">
        <p id="userUID">Loading...</p>
      </div>
    </div>

    <h2 style="margin-bottom: 25px; color: #00ff66; text-shadow: 0 0 10px rgba(0, 255, 102, 0.3);">üì¶ Token Packages</h2>

    <div class="packages-grid">
      <div class="package-card" onclick="selectPackage(10000, 3000, 'Starter')">
        <div class="package-icon">üöÄ</div>
        <div class="package-tokens">10K</div>
        <div class="package-label">Starter Pack</div>
        <div class="package-price">‚Ç¶3,000</div>
        <div class="package-currency">Nigerian Naira</div>
        <button class="buy-btn">Buy Now</button>
      </div>

      <div class="package-card" onclick="selectPackage(20000, 5000, 'Popular')">
        <div class="special-badge">‚≠ê POPULAR</div>
        <div class="package-icon">‚≠ê</div>
        <div class="package-tokens">20K</div>
        <div class="package-label">Popular Pack</div>
        <div class="package-price">‚Ç¶5,000</div>
        <div class="package-currency">Nigerian Naira</div>
        <button class="buy-btn">Buy Now</button>
      </div>

      <div class="package-card" onclick="selectPackage(35000, 9000, 'Premium')">
        <div class="package-icon">üíé</div>
        <div class="package-tokens">35K</div>
        <div class="package-label">Premium Pack</div>
        <div class="package-price">‚Ç¶9,000</div>
        <div class="package-currency">Nigerian Naira</div>
        <button class="buy-btn">Buy Now</button>
      </div>

      <div class="package-card" onclick="selectPackage(50000, 13000, 'Ultimate')">
        <div class="special-badge">üî• BEST VALUE</div>
        <div class="package-icon">üëë</div>
        <div class="package-tokens">50K</div>
        <div class="package-label">Ultimate Pack</div>
        <div class="package-price">‚Ç¶13,000</div>
        <div class="package-currency">Nigerian Naira</div>
        <button class="buy-btn">Buy Now</button>
      </div>
    </div>

    <div class="payment-methods">
      <h3>ÔøΩ Contact Method</h3>
      <div class="payment-options">
        <div class="payment-option active" onclick="selectPayment('whatsapp')">
          <div class="payment-icon">üí¨</div>
          <div class="payment-name">WhatsApp</div>
        </div>
      </div>
      <p style="margin-top: 15px; font-size: 12px; color: rgba(0, 255, 102, 0.7); text-align: center;">
        üì≤ You will be redirected to WhatsApp with your purchase details
      </p>
    </div>

    <div class="payment-methods" style="background: linear-gradient(135deg, rgba(255, 102, 0, 0.1) 0%, rgba(255, 102, 0, 0.05) 100%); border-color: #ff6600;">
      <h3 style="color: #ff6600;">üì± Install NEXCHAT App</h3>
      <p style="margin-bottom: 15px; font-size: 13px; color: rgba(255, 102, 0, 0.8);">Get the full NEXCHAT experience on your mobile device!</p>
      <div class="payment-options">
        <div class="payment-option" style="border-color: #ff6600; background: rgba(255, 102, 0, 0.05);" onclick="downloadAPK()">
          <div class="payment-icon">üì•</div>
          <div class="payment-name">Download APK</div>
        </div>
        <div class="payment-option" style="border-color: #ff6600; background: rgba(255, 102, 0, 0.05);" onclick="openPlayStore()">
          <div class="payment-icon">üéÆ</div>
          <div class="payment-name">Google Play</div>
        </div>
      </div>
      <p style="margin-top: 15px; font-size: 11px; color: rgba(255, 102, 0, 0.7); text-align: center;">
        üíæ App size: ~45MB | Requires Android 8.0+
      </p>
    </div>

    <div class="faq-section">
      <h3>‚ùì FAQ</h3>
      <div class="faq-item">
        <div class="faq-question">How do I use my tokens?</div>
        <div class="faq-answer">You can use tokens to transfer to friends, participate in premium features, and more!</div>
      </div>
      <div class="faq-item">
        <div class="faq-question">Are purchases refundable?</div>
        <div class="faq-answer">Please contact support for refund inquiries within 7 days of purchase.</div>
      </div>
      <div class="faq-item">
        <div class="faq-question">How long does payment take?</div>
        <div class="faq-answer">Instant! Tokens are added to your account immediately after successful payment.</div>
      </div>
      <div class="faq-item">
        <div class="faq-question">Is my payment secure?</div>
        <div class="faq-answer">Yes! We use industry-leading payment providers (Paystack & Flutterwave) for secure transactions.</div>
      </div>
    </div>
  </div>

  <div id="checkoutModal" class="modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeModal()">‚úï</button>
      <h2>Complete Your Purchase</h2>
      <p id="packageSummary"></p>
      
      <div class="loading" id="loadingSpinner">
        <div class="spinner"></div>
        <p>Processing payment...</p>
      </div>

      <div id="paymentForm">
        <input type="text" id="paymentPhone" placeholder="Enter your phone number" required>
        <button onclick="processPayment()">Pay Now üí∞</button>
        <p style="margin-top: 10px; font-size: 12px; color: rgba(0, 255, 102, 0.6);">
          You will be redirected to the payment gateway
        </p>
      </div>
    </div>
  </div>

  <script type="module">
    import { auth, db } from "./firebase-config.js";
    import { getDoc, doc, updateDoc, serverTimestamp, addDoc, collection } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

    let currentUser = null;
    let selectedPackage = null;
    let selectedPayment = 'whatsapp';

    auth.onAuthStateChanged(async (user) => {
      if (!user) {
        window.location.href = "index.html";
        return;
      }

      currentUser = user;
      document.getElementById("userUID").textContent = user.uid;

      const userDoc = await getDoc(doc(db, "users", user.uid));
      if (userDoc.exists()) {
        const tokens = userDoc.data().tokens || 0;
        document.getElementById("currentBalance").textContent = tokens.toLocaleString();
      }
    });

    window.selectPackage = function(tokens, price, name) {
      selectedPackage = { tokens, price, name };
      document.getElementById("packageSummary").innerHTML = `
        <div style="margin: 20px 0;">
          <div style="font-size: 28px; font-weight: 700; color: #00ff66; margin-bottom: 10px;">${tokens.toLocaleString()} Tokens</div>
          <div style="font-size: 16px; margin-bottom: 10px;">‚Ç¶${price.toLocaleString()}</div>
          <div style="font-size: 12px; color: rgba(0, 255, 102, 0.7);">${name} Pack</div>
        </div>
      `;
      document.getElementById("checkoutModal").classList.add("active");
    };

    window.selectPayment = function(method) {
      selectedPayment = method;
      document.querySelectorAll(".payment-option").forEach(el => {
        el.classList.remove("active");
      });
      event.target.closest(".payment-option").classList.add("active");
    };

    window.closeModal = function() {
      document.getElementById("checkoutModal").classList.remove("active");
    };

    window.processPayment = async function() {
      const phone = document.getElementById("paymentPhone").value.trim();

      if (!phone) {
        alert("‚ùå Please fill in all fields");
        return;
      }

      if (!selectedPackage) {
        alert("‚ùå Please select a package first");
        return;
      }

      if (!currentUser) {
        alert("‚ùå You must be logged in");
        return;
      }

      const message = `HELLO DEMON ALEX üëã\n\nI WANT TO PURCHASE THE FOLLOWING TOKENS:\n\nüì¶ Package: ${selectedPackage.name}\nüíé Tokens: ${selectedPackage.tokens.toLocaleString()}\nüí∞ Price: ‚Ç¶${selectedPackage.price.toLocaleString()}\n\nüîê NEX-UID: ${currentUser.uid}\nüì± Phone: ${phone}\n\nPlease confirm and process my payment. Thank you!`;

      const whatsappLink = `https://wa.me/2349054345858?text=${encodeURIComponent(message)}`;

      window.open(whatsappLink, "_blank");
      
      setTimeout(() => {
        alert("‚úÖ Opening WhatsApp...\n\nPlease send the message to complete your purchase!");
        closeModal();
      }, 500);
    };

    function initializePaystack(email, phone, amount, reference, tokens) {
      const script = document.createElement("script");
      script.src = "https://js.paystack.co/v1/inline.js";
      document.head.appendChild(script);

      script.onload = () => {
        const handler = PaystackPop.setup({
          key: "pk_live_YOUR_PAYSTACK_KEY",
          email: email,
          amount: amount * 100,
          ref: reference,
          onClose: () => {
            document.getElementById("loadingSpinner").style.display = "none";
            document.getElementById("paymentForm").style.display = "block";
            alert("‚ùå Payment was cancelled");
          },
          onSuccess: (response) => {
            completeTransaction(tokens, reference, "paystack", email);
          }
        });
        handler.openIframe();
      };
    }

    function initializeFlutterwave(email, phone, amount, reference, tokens) {
      const script = document.createElement("script");
      script.src = "https://checkout.flutterwave.com/v3.js";
      document.head.appendChild(script);

      script.onload = () => {
        FlutterwaveCheckout({
          public_key: "FLWPUBK_TEST_YOUR_FLUTTERWAVE_KEY",
          tx_ref: reference,
          amount: amount,
          currency: "NGN",
          payment_options: "card,ussd",
          customer: {
            email: email,
            phone_number: phone
          },
          callback: (response) => {
            if (response.status === "successful") {
              completeTransaction(tokens, reference, "flutterwave", email);
            } else {
              document.getElementById("loadingSpinner").style.display = "none";
              document.getElementById("paymentForm").style.display = "block";
              alert("‚ùå Payment failed");
            }
          },
          onclose: () => {
            document.getElementById("loadingSpinner").style.display = "none";
            document.getElementById("paymentForm").style.display = "block";
          }
        });
      };
    }

    function showBankTransferDetails(amount, reference) {
      alert(`
üè¶ Bank Transfer Details
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
Amount: ‚Ç¶${amount.toLocaleString()}
Reference: ${reference}

Please transfer to:
Account Name: idowu 
Account Number: 9054345858
Bank: opay 

After transfer, screenshot proof and send to support@nexchat.com
Include your username, uid number and reference number.

Tokens will be added within 2 hours! 
      `);
      closeModal();
    }

    async function completeTransaction(tokens, reference, method, email) {
      try {
        await updateDoc(doc(db, "users", currentUser.uid), {
          tokens: (await getDoc(doc(db, "users", currentUser.uid))).data().tokens + tokens,
          lastPurchase: serverTimestamp()
        });

        await addDoc(collection(db, "transactions"), {
          userId: currentUser.uid,
          email: email,
          tokens: tokens,
          amount: selectedPackage.price,
          method: method,
          reference: reference,
          status: "completed",
          timestamp: serverTimestamp()
        });

        alert(`‚úÖ Payment successful!\n\n${tokens.toLocaleString()} tokens added to your account!`);
        setTimeout(() => {
          window.location.href = "chat.html";
        }, 1500);
      } catch (err) {
        console.error("Transaction error:", err);
        alert("‚ùå Error completing transaction: " + err.message);
        document.getElementById("loadingSpinner").style.display = "none";
        document.getElementById("paymentForm").style.display = "block";
      }
    }

    function downloadAPK() {
      // Create a download link for the APK file
      const apkUrl = "nexchat.apk"; // Change this to your actual APK file path
      const link = document.createElement("a");
      link.href = apkUrl;
      link.download = "nexchat.apk";
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      
      // Alternative: If APK is hosted on a server
      // window.open("https://your-server.com/nexchat.apk", "_blank");
    }

    function openPlayStore() {
      // Open NEXCHAT on Google Play Store
      // Replace with your actual Play Store link when app is published
      const playStoreUrl = "https://play.google.com/store/apps/details?id=com.nexchat.app";
      window.open(playStoreUrl, "_blank");
      
      // Fallback message if app isn't on Play Store yet
      alert("üöÄ NEXCHAT will be available on Google Play Store soon!\n\nFor now, you can download the APK directly.");
    }
  </script>
</body>
</html>
